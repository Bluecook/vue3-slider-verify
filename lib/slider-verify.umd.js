(function(v,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(v=typeof globalThis<"u"?globalThis:v||self,n(v["vue3-slider-verify"]={},v.Vue))})(this,function(v,n){"use strict";const x=r=>(n.pushScopeId("data-v-49b64f1a"),r=r(),n.popScopeId(),r),B=["width","height"],$=["width","height"],j=[x(()=>n.createElementVNode("svg",{t:"1697120534385",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4319",width:"24",height:"24"},[n.createElementVNode("path",{d:"M512 32C246.4 32 32 246.4 32 512s214.4 480 480 480 480-214.4 480-480S777.6 32 512 32z m288 566.4c-38.4 128-156.8 214.4-288 214.4-166.4 0-300.8-134.4-300.8-300.8S345.6 211.2 512 211.2c83.2 0 160 32 214.4 89.6v-16c0-19.2 12.8-32 32-32s32 12.8 32 32v86.4c0 19.2-12.8 32-32 32H652.8c-19.2 0-32-12.8-32-32s12.8-32 32-32h22.4c-44.8-41.6-102.4-64-163.2-64-131.2 0-236.8 105.6-236.8 236.8S380.8 748.8 512 748.8c105.6 0 198.4-70.4 227.2-169.6 6.4-16 22.4-25.6 38.4-22.4 16 6.4 25.6 22.4 22.4 41.6z","p-id":"4320",fill:"#FFF"})],-1))],A=x(()=>n.createElementVNode("span",{class:"slider_text"},"向右滑动完成验证",-1)),N=5,D=n.defineComponent({__name:"index",props:{img:{},verifyPass:{type:Boolean},width:{},height:{}},emits:["onSuccess","onError"],setup(r,{emit:c}){const a=r,f=t=>`https://z1.ax1x.com/2023/10/17/${t}.jpg`;function L(){const t=[f("piPmwgP"),f("piPma9I"),f("piPmd3t"),f("piPmN4A"),f("piPmeAJ")];return t[Math.floor(Math.random()*t.length)]}const u=n.ref(a.width?a.width:320),d=n.ref(a.height?a.height:180),S=n.ref(),p=n.ref();let M=n.ref(""),b=n.ref().value,P=n.ref().value;const s=n.ref(0);let m=!1,E=0,h=n.ref(56),W=n.ref(1).value,g=n.ref(86),l=n.ref(99);const F=(t,o)=>Math.ceil(Math.random()*(o-t)+t);n.onMounted(()=>{T()}),n.onUnmounted(()=>{window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",z),window.removeEventListener("mousedown",X),window.removeEventListener("touchmove",I),window.removeEventListener("touchend",_),window.removeEventListener("touchstart",C)});function O(t){const o=t.getContext("2d");if(!o)return;const e=new Image;e.src=M.value,e.onload=()=>{o.drawImage(e,0,0,u.value,d.value),k(o),o.fill()}}function k(t,o){let e=Math.ceil(16*W),i=o!==void 0?o:g.value;t.beginPath(),t.moveTo(i,l.value),t.lineTo(i+e,l.value),t.arcTo(i+e,l.value-e/2,i+e+e/2,l.value-e/2,e/2),t.arcTo(i+e+e,l.value-e/2,i+e+e,l.value,e/2),t.lineTo(i+e+e+e,l.value),t.lineTo(i+e+e+e,l.value+e),t.arcTo(i+e+e+e+e/2,l.value+e,i+e+e+e+e/2,l.value+e+e/2,e/2),t.arcTo(i+e+e+e+e/2,l.value+e+e,i+e+e+e,l.value+e+e,e/2),t.lineTo(i+e+e+e,l.value+e+e+e),t.lineTo(i,l.value+e+e+e),t.lineTo(i,l.value+e+e),t.arcTo(i+e/2,l.value+e+e,i+e/2,l.value+e+e/2,e/2),t.arcTo(i+e/2,l.value+e,i,l.value+e,e/2),t.lineTo(i,l.value)}function X(t){m=!0,E=t.clientX,window.addEventListener("mousemove",V),window.addEventListener("mouseup",z)}function V(t){if(m){const o=t.clientX-E;o>0&&o<u.value-60&&(s.value=o)}}function z(){m=!1,window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",z),Math.abs(g.value-s.value)<N?(c("onSuccess",{type:"success",message:"验证通过",verify:!0}),a.verifyPass&&a.verifyPass===!0&&setTimeout(()=>{s.value=0},600)):(c("onError",{type:"error",message:"验证失败",verify:!1}),s.value=0,T())}const T=()=>{if(M.value=a.img?a.img:L(),g.value=F(h.value,u.value-h.value),l.value=F(20,d.value-h.value),S.value&&O(S.value),p.value){p.value.width=h.value,p.value.height=d.value;const t=p.value.getContext("2d");if(t){const o=new Image;o.src=M.value,o.onload=()=>{b=o.width/u.value,P=o.height/d.value,o.width=u.value,o.height=d.value,t.drawImage(o,g.value*b,(l.value-16)*P,h.value*b,d.value*P,0,l.value-16,h.value,d.value)},k(t,0),t.clip()}}},R=()=>{s.value!==0&&(s.value=0),T()},C=t=>{console.log(t.touches[0].clientX,t.touches[0].clientY),m=!0,E=t.touches[0].clientX,window.addEventListener("touchmove",I),window.addEventListener("touchend",_),window.addEventListener("touchcancel",_)},_=()=>{m=!1,window.addEventListener("touchmove",I),window.addEventListener("touchend",_),window.addEventListener("touchcancel",_),Math.abs(g.value-s.value)<N?(c("onSuccess",{type:"success",message:"验证通过",verify:!0}),a.verifyPass&&a.verifyPass===!0&&setTimeout(()=>{s.value=0},600)):(c("onError",{type:"error",message:"验证失败",verify:!1}),s.value=0,T())},I=t=>{if(m){const o=t.touches[0].clientX-E;o>0&&o<u.value-60&&(s.value=o)}};return(t,o)=>(n.openBlock(),n.createElementBlock(n.Fragment,null,[n.createElementVNode("div",{class:"slide_puzzle",style:n.normalizeStyle({width:`${u.value}px`,height:`${d.value}px`})},[n.createElementVNode("canvas",{ref_key:"canvas",ref:S,width:u.value,height:d.value,class:"mb-4"},null,8,B),n.createElementVNode("canvas",{ref_key:"sliderImg",ref:p,width:n.unref(h),style:n.normalizeStyle({top:"0px",left:s.value+"px"}),class:"slider_img",height:d.value},null,12,$),n.createElementVNode("div",{class:"refresh",onClick:R},j)],4),n.createElementVNode("div",{class:"slider",style:n.normalizeStyle({width:`${u.value}px`})},[A,n.createElementVNode("div",{class:"slider_text_bg",style:n.normalizeStyle({width:s.value+"px"})},null,4),n.createElementVNode("div",{class:"slider_bar",style:n.normalizeStyle({left:s.value+"px"}),onMousedown:X,onTouchstart:C},null,36)],4)],64))}}),q="",w=((r,c)=>{const a=r.__vccOpts||r;for(const[f,L]of c)a[f]=L;return a})(D,[["__scopeId","data-v-49b64f1a"]]);w.name="slider-verify",w.install=r=>{r.component("slider-verify",w)};const H=[w],y=function(r){y.installed||(y.installed=!0,H.map(c=>{r.component(c.name,c)}))};typeof window<"u"&&window.Vue&&y(window.Vue);const U={install:y};v.default=U,v.sliderVerify=w,Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
